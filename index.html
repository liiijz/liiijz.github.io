<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="看区块">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="看区块">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="看区块">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>看区块</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">看区块</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">kanqukuai.cn</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/13/ERC721深度剖析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李工">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="看区块">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/13/ERC721深度剖析/" itemprop="url">深入分析ERC721</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-13T10:24:49+08:00">
                2018-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>理解不可替代的以太坊代币</p>
<p><strong>李工翻译，转载请注明出处</strong></p>
<p><a href="https://medium.com/crypto-currently/the-anatomy-of-erc721-e9db77abfc24" target="_blank" rel="noopener">https://medium.com/crypto-currently/the-anatomy-of-erc721-e9db77abfc24</a></p>
<p>很多人都已经听说过了以太坊区块链上的叫做加密猫的新游戏。这款游戏目前在虚拟货币社区产生了巨大影响，因为这款游戏有着极其独特的创意。加密猫是一款可以让玩家进行买，卖，交易，以及繁殖数字猫咪。他们被认为是“可以繁殖的豆豆娃（一种玩具）”，而且每只猫都是独一无二的。 这种独一无二的特性使得加密猫咪变得极其可以收藏的，会使人对一些猫的特征产生兴趣并且希望拥有它们。</p>
<p><img src="https://cdn-images-1.medium.com/max/800/0*kp_ccS26KoORhJjK.png" alt="image"></p>
<p>但是数字收藏品并不仅仅局限于数字猫咪。人类总是一直有收藏东西的历史；所以这不新鲜。从物理的钱币到精灵宝可梦的卡片，人们总是喜欢收集。这是一种嗜好，由于对稀缺事物有着极大的兴趣。类似于商品价值与其稀缺程度的关系。收藏品的价值对于收藏者来说是与收藏品在其它物品中的稀缺性相关联的。</p>
<p>我们能够通过以太坊的代币来模拟稀有的可收藏的物品，同时每一种这样的代币都遵循着以太坊社区一种叫ERC721的新的标准。以太坊第721号征求意见稿，又叫ERC721，是一个以太坊改进提案由Dieter Shirley在2017年底提出的。这个提案使得智能合约代币能够像ERC20一样被交易。ERC721代币之间都是独一无二的，而且这些代币之间是不可替换的。</p>
<p><a href="https://github.com/ethereum/EIPs/issues/721" target="_blank" rel="noopener">ERC: Non-fungible Token Standard #721</a></p>
<p>可替换 - 是指某种东西（例如金钱或日用品）的其一部分或一定数量可以被另一种等量的物品所替代，以支付债务或账户结算。</p>
<p>本质上可替换性是指资产的一个特征，在这里指代币，决定相同或相似类型或数量的物品在交换或使用过程中是否可以被完全互换。</p>
<p>例如，下面的美国五美元钞票可用于从便利店购买汽水。</p>
<p><img src="https://cdn-images-1.medium.com/max/800/0*dGUMTP3G41z_tcEx.jpg" alt="image"></p>
<p>五元美钞具有价值，可用于购买价值相同或较低的物品。 但是，当有人用下面的棒球卡来购买苏打水时，店主应该不会接受。</p>
<p><img src="https://cdn-images-1.medium.com/max/800/0*D_FwqTj-7Z0mhPnm.jpg" alt="image"></p>
<p>为什么上面的卡洛斯桑塔纳卡不会被店主接受，当它的价值是5美元时，是否与五元美钞一样呢？ 这是因为棒球卡和美元钞票具有不同的特征，由不同的人来定义它们的价值。 一个7岁的孩子可能愿意为棒球卡支付7美元，因为他们喜欢卡上的颜色。但是，店主甚至不认为这张卡的价格为5美元，仅仅因为它并非像美元那样由美联储发行。 棒球卡和美元钞票具有的独特属性使得它们不具有可替代性，因为它们根据交易过程具有不同的价值，并且不总是能互换使用。</p>
<p>就收藏品而言，如果收藏品具有不同的特征，这两件收藏品就是不可替代的。对于物理硬币，金币不能与铜币互换，因为它们的不同特征赋予了它们不同的价值对于收藏者来说。</p>
<p>ERC721代币能够用于任何交易，但它们的价值是由它的独特性与稀缺性所决定的。该标准定义了一下方法：</p>
<ul>
<li>name 代币名称，比如资产币，古董币</li>
<li>symbol 代币符号</li>
<li>totalSupply 发行总量</li>
<li>balanceOf 某账户拥有的代币总数，藏品总数</li>
<li>ownerOf 代币、藏品的拥有者，所属权</li>
<li>approve 批准</li>
<li>takeOwnership </li>
<li>transfer 交易，转换所属权</li>
<li>tokenOfOwnerByIndex</li>
<li>tokenMetadata<br>同时还定义了两个事件：Transfer 与 Approval</li>
</ul>
<p>注意：这是ERC721合约的简要声明示范</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">contract ERC721 &#123;</span><br><span class="line">   <span class="comment">// ERC20 compatible functions</span></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string name</span>);</span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">symbol</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string symbol</span>);</span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">totalSupply</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint256 totalSupply</span>);</span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint balance</span>);</span></span><br><span class="line"><span class="function">   // <span class="title">Functions</span> <span class="title">that</span> <span class="title">define</span> <span class="title">ownership</span></span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">address owner</span>);</span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>);</span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>);</span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>);</span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">tokenOfOwnerByIndex</span>(<span class="params">address _owner, uint256 _index</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint tokenId</span>);</span></span><br><span class="line"><span class="function">   // <span class="title">Token</span> <span class="title">metadata</span></span></span><br><span class="line"><span class="function">   <span class="title">function</span> <span class="title">tokenMetadata</span>(<span class="params">uint256 _tokenId</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string infoUrl</span>);</span></span><br><span class="line"><span class="function">   // <span class="title">Events</span></span></span><br><span class="line"><span class="function">   <span class="title">event</span> <span class="title">Transfer</span>(<span class="params">address indexed _from, address indexed _to, uint256 _tokenId</span>);</span></span><br><span class="line"><span class="function">   <span class="title">event</span> <span class="title">Approval</span>(<span class="params">address indexed _owner, address indexed _approved, uint256 _tokenId</span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>合约的每个字段的概述如下：</p>
<p>记住：以下代码仅用于教育目的，未经测试。 请不要在生产环境中实现它！</p>
<h2><span id="类似erc20的函数">类似ERC20的函数</span></h2><p>ERC721定义了一些功能，使其符合ERC20令牌标准。 它可以使现有钱包更容易显示有关令牌的简单信息。 这些功能让符合此标准的智能合约看上去像通用的加密货币（如比特币或以太坊），通过定义允许用户操作的功能，例如将令牌发送给他人和检查账户余额。</p>
<h3><span id="name">name</span></h3><p>该函数用于告知外部合约和应用程序此令牌的名称。 该函数的一个示例实现如下所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"My Non-Fungible Token"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="symbol">symbol</span></h3><p>该功能用于提供符合ERC20标准的兼容性。 它为外部程序提供代币的简写名称或符号。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">symbol</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string symbol</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"MNFT"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="totalsupply">totalSupply</span></h3><p>该函数返回区块链上可用的代币总数。但供应量不一定总是恒定的。比如可以增发或者销毁。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  <span class="comment">// This can be an arbitrary number</span></span><br><span class="line">  uint256 private totalSupply = <span class="number">1000000000</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">totalSupply</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint256 supply</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> totalSupply;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="balanceof">balanceOf</span></h3><p>该函数用于指示给定地址所拥有的代币数量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) private balances;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint balance</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> balances[_owner];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="所有权函数">所有权函数</span></h2><p>这些函数定义协议中如何处理令牌所有权以及如何转让所有权。 这些功能中最值得注意的是takeOwnership和transfer，分别起到撤销功能和发送功能的作用。</p>
<h3><span id="ownerof">ownerOf</span></h3><p>该函数返回某个代币所有者的地址。 由于每个ERC721令牌都是不可互换的，因此它们是唯一的，通过唯一的ID在区块链中被引用。 我们可以使用其ID来确定令牌的所有者。ID，跟账户是一对一的映射关系。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">uint256</span> =&gt;</span> address) private tokenOwners;</span><br><span class="line">  mapping(<span class="function"><span class="params">uint256</span> =&gt;</span> bool) private tokenExists;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>)</span></span><br><span class="line"><span class="function">  <span class="title">constant</span> <span class="title">returns</span> (<span class="params">address owner</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(tokenExists[_tokenId]);</span><br><span class="line">    <span class="keyword">return</span> tokenOwners[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="approve">approve</span></h3><p>此功能批准或授予其他实体代表所有者转让代币的权限。</p>
<p>例如，如果李工拥有1个MyNFT，她可以为她的朋友小张调用批准功能。<br>成功调用后，小张可以代表李工以后对该令牌进行所有权进行操作。<br>有关转让所有权的更多信息可以在takeOwnership与transfer函数中看到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256)) allowed;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(msg.sender == ownerOf(_tokenId));</span><br><span class="line">    <span class="built_in">require</span>(msg.sender != _to);</span><br><span class="line">    allowed[msg.sender][_to] = _tokenId;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="takeownership">takeOwnership</span></h3><p>这个功能就像一个收款功能，因为外部用户可以调用它来从另一个用户的帐户中取出令牌。 因此，当用户被批准拥有一定数量的令牌并希望从另一个用户的余额中提取所述令牌时，可以使用takeOwnership函数。A用户调用approve授权B用户可以提取某TokenID，B用户调用takeOwnership取出TokenID到自己账户。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(tokenExists[_tokenId]);</span><br><span class="line">    address oldOwner = ownerOf(_tokenId);</span><br><span class="line">    address newOwner = msg.sender;</span><br><span class="line">    <span class="built_in">require</span>(newOwner != oldOwner);</span><br><span class="line">    <span class="built_in">require</span>(allowed[oldOwner][newOwner] == _tokenId);</span><br><span class="line">    balances[oldOwner] -= <span class="number">1</span>;</span><br><span class="line">    tokenOwners[_tokenId] = newOwner;</span><br><span class="line">    balances[newOwner] += <span class="number">1</span>;</span><br><span class="line">    Transfer(oldOwner, newOwner, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3><span id="transfer">transfer</span></h3><p>转移代币的下一个方法就是这个函数，transfer让代币的所有者发送代币到另一个用户，如同标准的加密货币。但是，只能当接受者的账户已经被发送者的账户前置批准拥有这些代币，交易才会被发起。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> mapping(<span class="function"><span class="params">uint256</span> =&gt;</span> uint256)) private ownerTokens;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">removeFromTokenList</span>(<span class="params">address owner, uint256 _tokenId</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(uint256 i = <span class="number">0</span>;ownerTokens[owner][i] != _tokenId;i++)&#123;</span><br><span class="line">      ownerTokens[owner][i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>)</span>&#123;</span><br><span class="line">    address currentOwner = msg.sender;</span><br><span class="line">    address newOwner = _to;</span><br><span class="line">    <span class="built_in">require</span>(tokenExists[_tokenId]);</span><br><span class="line">    <span class="built_in">require</span>(currentOwner == ownerOf(_tokenId));</span><br><span class="line">    <span class="built_in">require</span>(currentOwner != newOwner);</span><br><span class="line">    <span class="built_in">require</span>(newOwner != address(<span class="number">0</span>));</span><br><span class="line">    removeFromTokenList(_tokenId);</span><br><span class="line">    balances[oldOwner] -= <span class="number">1</span>;</span><br><span class="line">    tokenOwners[_tokenId] = newOwner;</span><br><span class="line">    balances[newOwner] += <span class="number">1</span>;</span><br><span class="line">    Transfer(oldOwner, newOwner, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="tokenofownerbyindex-选用推荐">tokenOfOwnerByIndex （选用——推荐）</span></h3><p>每个不可互换的代币拥有者能同时拥有不止一个代币。因为每个代币由其唯一的ID进行标识，但是，追踪用户拥有的某个特定的代币可能会比较困难。为了达到这个目的，协议保存了一个记录关于每个用户拥有的所有代币的ID。因此，一个用户拥有的某种代币能够从用户拥有的代币列表中通过索引获取到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> mapping(<span class="function"><span class="params">uint256</span> =&gt;</span> uint256)) private ownerTokens;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">tokenOfOwnerByIndex</span>(<span class="params">address _owner, uint256 _index</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint tokenId</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ownerTokens[_owner][_index];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="metadata-function">Metadata Function</span></h2><p>就像我们之前说过的那样，使不可互换的物品具有不可替代特性是因为它们有着独特的一组属性。 美元和棒球卡是不可替代的，因为它们具有不同的特征。 但是，将数据存储在区块链中，以说明每个代币的特征是非常昂贵且不推荐的。 为了解决这个问题，我们可以将引用（如IPFS哈希字符串或HTTP（S）的链接）存储到链上每个令牌的属性，以便链外的程序可以执行逻辑来查找有关令牌的更多信息。 这些引用是关于数据或元数据的数据。</p>
<h3><span id="tokenmetadata-选用推荐">tokenMetadata （选用——推荐）</span></h3><p>这个函数让我找到一个代币的元属性，或者一个元属性的链接</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">uint256</span> =&gt;</span> string) tokenLinks;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">tokenMetadata</span>(<span class="params">uint256 _tokenId</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string infoUrl</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> tokenLinks[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="events-事件">Events 事件</span></h2><p>无论何时当合约调用函数的时候都会触发相应的事件，一旦他们被触发，就会被广播到正在监听这些事件的程序里。外部程序监听着区块链的事件这样一旦事件被触发的时候，它们可以使用事件提供的信息来执行相应的逻辑。<br>ERC721代币标准定义了两个如下的事件。</p>
<h2><span id="transfer-交易事件">Transfer 交易事件</span></h2><p>无论何时，当一个代币易手的时候这个事件就会被触发。当一个代币的所有权从一个用户转移到另一个用户的时候事件会被广播。它描述了是由哪一个账户发送的代币，哪个账户能接收这个代币，以及哪一个代币（ID）被交易了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="approval-授权事件">Approval 授权事件</span></h2><p>无论何时，当一个用户授权另一个用户得到某一个代币的所有权的时候，这个事件会被触发（比如当approve函数被执行的时候）。这个事件描述了哪个账户现在正拥有着这个代币，以及哪个账户即将被允许拥有代币，以及哪个代币（ID）被批准进行所有权的转让。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract MyNFT &#123;</span><br><span class="line">  event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://gist.github.com/aunyks/b25cffd4f4250a3fbf26e3a626441e33" target="_blank" rel="noopener">我的ERC721代码的实现在这里</a></p>
<p>与ERC20类似，新提出的ERC721标准为新的不可替换的物品的智能合约开辟了一条道路。正如在CryptoKitties，Decentraland，CryptoPunks和其他应用程序中可以看到的，不可互换的令牌已被证明是非常高需求的产品。 甚至维基解密都拥有几个高价的加密猫！ 最终这一标准将进一步扩大加密货币经济并有助于推动这一领域的进一步发展。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/07/什么是比特币挖矿/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李工">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="看区块">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/07/什么是比特币挖矿/" itemprop="url">什么是比特币挖矿【科普向】</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-07T12:28:25+08:00">
                2018-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>中文字幕，李工翻译</p>
<iframe src="https://static.hdslb.com/miniloader.swf?aid=19220178&page=1" frameborder="0" allowfullscreen="true" width="100%" height="100%"></iframe>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/07/什么是比特币/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李工">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="看区块">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/07/什么是比特币/" itemprop="url">什么是比特币【科普向】</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-07T11:48:21+08:00">
                2018-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>中文字幕，李工翻译</p>
<iframe src="https://static.hdslb.com/miniloader.swf?aid=19219652&p=1" frameborder="0" allowfullscreen="true" width="100%" height="100%"></iframe>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/01/如何在以太网上创建你自己的加密猫游戏/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李工">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="看区块">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/01/如何在以太网上创建你自己的加密猫游戏/" itemprop="url">如何在以太网上创建你自己的加密猫游戏</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-01T10:28:59+08:00">
                2018-03-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://medium.com/loom-network/how-to-code-your-own-cryptokitties-style-game-on-ethereum-7c8ac86a4eb3" target="_blank" rel="noopener">原文链接</a> </p>
<p>李工翻译，转载请注明出处</p>
<p>加密猫游戏很好的证明了区块链除了简单金融交易以外的用途</p>
<p>我希望我们在未来能看到更多跟加密猫一样的区块链技术在游戏领域的创新应用。所以我希望能写一个关于加密猫代码的快速攻略，用来展示这个游戏是怎么被实现的。</p>
<p>这篇文章是写给开发者的，但这不是一个介绍Solidity的新手教程，我尝试包含了参考文档的链接使文章尽可能适用于所有层次的开发者。</p>
<p>让我们来一探究竟…</p>
<h2><span id="加密猫源代码">加密猫源代码</span></h2><p>几乎所有的加密猫游戏代码都是开源的，所以搞懂加密猫是怎么工作的最好办法就是研读它的源代码。</p>
<p>总共有大约2000行左右的代码，所以在这篇文章里，我将只过一遍我觉得非常重要的部分。同时这里也有一份加密猫的所有智能合约代码的拷贝如果你想通过自己来阅读代码。</p>
<p><a href="https://ethfiddle.com/09YbyJRfiI" target="_blank" rel="noopener">加密猫源代码 EthFiddle</a></p>
<h2><span id="顶层总览">顶层总览：</span></h2><p>如果你不是很熟悉什么是加密猫，那么我会告诉你加密猫其实是一个关于购买，出售以及繁殖数字猫咪的游戏。每只猫咪拥有一个唯一的外观（由它的基因所决定），当你尝试繁殖两只猫咪，它们的基因会以一种独特的方式结合在一起产生出新的后代。然后你可以出售或者继续繁殖这些后代品种。</p>
<p>加密猫的代码被分割成了若干小型的子合约用来分类，只让相关的代码绑定在一起，而不是形成一个巨大的文件包含了所有东西。</p>
<p>子合约从最主要的猫咪合约继承而来，它看上去像这个样子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract KittyAccessControl</span><br><span class="line">contract KittyBase is KittyAccessControl</span><br><span class="line">contract KittyOwnership is KittyBase, ERC721</span><br><span class="line">contract KittyBreeding is KittyOwnership</span><br><span class="line">contract KittyAuction is KittyBreeding</span><br><span class="line">contract KittyMinting is KittyAuction</span><br><span class="line">contract KittyCore is KittyMinting</span><br></pre></td></tr></table></figure>
<p>由此可见 KittyCore 是应用指向的终极合约地址，同时它继承了前面合约的所有数据跟方法（类似于类型继承派生）。</p>
<p>让我们依次的过一遍这些合约：</p>
<hr>
<h3><span id="1-kittyaccesscontrol-猫咪访问权限控制谁控制这些合约合约执行的权限">1. KittyAccessControl 猫咪访问权限控制：谁控制这些合约？合约执行的权限。</span></h3><p><em>该合约管理着多个地址跟约束条件，只为特定的角色提供操作权限，比如CEO，CFO，COO。</em></p>
<p>这个合约只是用来管理合约，而与游戏的机制没有一点关系。它只是提供了一些‘setter’设置方法给CEO，COO和CFO，只是一些以太坊地址，拥有着特殊的所有权并且支配着特定的合同功能。</p>
<p>KittyAccessControl定义了一些函数修改器比如onlyCEO（一个只有CEO能执行的函数），并且增加了一些方法来暂停/停止暂停 合同跟资金：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">modifier onlyCLevel() &#123;</span><br><span class="line">    require(</span><br><span class="line">        msg.sender == cooAddress ||</span><br><span class="line">        msg.sender == ceoAddress ||</span><br><span class="line">        msg.sender == cfoAddress</span><br><span class="line">    );</span><br><span class="line">    _;</span><br><span class="line">&#125;</span><br><span class="line">//...some other stuff</span><br><span class="line">// Only the CEO, COO, and CFO can execute this function:</span><br><span class="line">function pause() external onlyCLevel whenNotPaused &#123;</span><br><span class="line">    paused = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>pause()方法被加入的原因很可能是因为开发人员预测在系统发生了不可预料的bug的时候，可以暂停系统来进行修复和更新。但正如我的同事卢克指出的一样，事实上这可能会让开发人员拥有完全冻结合约的权利（中心化操作），然后将导致没有人能够转移，出售，或者繁殖他们的猫咪！有趣的是，因为大多数人认为DApp是完全去中心化的因为它们是运行在以太坊上的。</p>
<p>继续前进…</p>
<h3><span id="2-kittybase-猫咪base猫咪的基类到底猫咪是个啥东西">2. KittyBase 猫咪Base：猫咪的基类，到底猫咪是个啥东西？</span></h3><p><em>这一部分我们定义了最基础的代码来共享整个核心功能。这包括我们的主数据存储，常量以及数据类型，以及包括用来管理这些数据的内部函数</em></p>
<p>KittyBase 定义了这个游戏的大量的核心数据。首先，它定义了一个猫咪结构体：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct Kitty &#123;</span><br><span class="line">    uint256 genes;</span><br><span class="line">    uint64 birthTime;</span><br><span class="line">    uint64 cooldownEndBlock;</span><br><span class="line">    uint32 matronId;</span><br><span class="line">    uint32 sireId;</span><br><span class="line">    uint32 siringWithId;</span><br><span class="line">    uint16 cooldownIndex;</span><br><span class="line">    uint16 generation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以我猜测一只猫咪其实就是一大堆无符号整形数…</p>
<p>来细看每一个数据：</p>
<ul>
<li>genes 基因数： 一个256位整形用来表示猫咪的基因代码。这是核心数据用来决定这只猫咪的外形。</li>
<li>birthTime 出生时间： 一个区块的时间戳记录这只猫诞生的时间。</li>
<li>cooldownEndBlock 冷却结束： 一只猫能够再次参与繁殖的最小时间戳。</li>
<li>matronId &amp; sireId 父母ID： 分别表示这只猫咪的父母的ID。</li>
<li>siringWithId 怀的谁的：如果一直猫怀孕了，这里记录了配偶的的ID，否则为零。</li>
<li>cooldownIndex 冷却索引：这只猫的当前冷却时间（当一只猫咪交配繁殖以后到下一次能够繁殖所需要等待的时间）</li>
<li>generation 世代：表示这只猫是第几代。第一只由合同创造的猫的generation值为0；新生猫咪的世代值取父母世代最大值，加1。</li>
</ul>
<p>需要注意的是在加密猫里，猫咪都是无性的，任意两只猫被允许参与繁殖 —— 因此加密猫咪都是没有性别的。</p>
<p>KittyBase合约类型接着定义了一个猫咪合约类型的数据结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kitty[] kitties;</span><br></pre></td></tr></table></figure>
<p>这个数组保持了现存的所有猫咪的数据，所以它有点像是主要的猫咪数据库。无论何时，当一只新的猫咪创建后，它会被加入到这个数组中来，数组的索引将成为这只猫的ID，比如创世猫拥的ID为1：</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*b0GUOvwNgGnnJxu9Pyzibg.png" alt="image"></p>
<p>这个合约同样包括了一组映射，从猫咪的ID到猫咪主人的地址，用来跟踪猫咪的主任信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 猫咪索引到所有者</span><br><span class="line">mapping (uint256 =&gt; address) public kittyIndexToOwner;</span><br></pre></td></tr></table></figure>
<p>同样合约定义了一些其它的映射，但因为本文章长度有限，在这里就不赘述了。</p>
<p>无论何时，当一只猫咪被从一个人转移到另一个人的时候，kittyIndexToOwner会被更新来反应它新的主人：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @dev Assigns ownership of a specific Kitty to an address.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint256 _tokenId</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Since the number of kittens is capped to 2^32 we can't overflow this</span></span><br><span class="line">    ownershipTokenCount[_to]++;</span><br><span class="line">    <span class="comment">// transfer ownership</span></span><br><span class="line">    kittyIndexToOwner[_tokenId] = _to;</span><br><span class="line">    <span class="comment">// When creating new kittens _from is 0x0, but we can't account that address.</span></span><br><span class="line">    <span class="keyword">if</span> (_from != address(<span class="number">0</span>)) &#123;</span><br><span class="line">        ownershipTokenCount[_from]--;</span><br><span class="line">        <span class="comment">// once the kitten is transferred also clear sire allowances</span></span><br><span class="line">        <span class="keyword">delete</span> sireAllowedToAddress[_tokenId];</span><br><span class="line">        <span class="comment">// clear any previously approved ownership exchange</span></span><br><span class="line">        <span class="keyword">delete</span> kittyIndexToApproved[_tokenId];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Emit the transfer event.</span></span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>转让猫咪的所有权将设置kittyIndexToOwner，将猫咪的ID设置为接收者的地址。</em></p>
<p>现在让我们来看一下当一只猫咪被创造的时候会发生什么：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_createKitty</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 _matronId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 _sireId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 _generation,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 _genes,</span></span></span><br><span class="line"><span class="function"><span class="params">    address _owner</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span></span><br><span class="line"><span class="function"><span class="title">internal</span></span></span><br><span class="line"><span class="function"><span class="title">returns</span>(<span class="params">uint</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// These requires are not strictly necessary, our calling code should make</span></span><br><span class="line">    <span class="comment">// sure that these conditions are never broken. However! _createKitty() is already</span></span><br><span class="line">    <span class="comment">// an expensive call (for storage), and it doesn't hurt to be especially careful</span></span><br><span class="line">    <span class="comment">// to ensure our data structures are always valid.</span></span><br><span class="line">    <span class="built_in">require</span>(_matronId == uint256(uint32(_matronId)));</span><br><span class="line">    <span class="built_in">require</span>(_sireId == uint256(uint32(_sireId)));</span><br><span class="line">    <span class="built_in">require</span>(_generation == uint256(uint16(_generation)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// New kitty starts with the same cooldown as parent gen/2</span></span><br><span class="line">    uint16 cooldownIndex = uint16(_generation / <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (cooldownIndex &gt; <span class="number">13</span>) &#123;</span><br><span class="line">        cooldownIndex = <span class="number">13</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Kitty memory _kitty = Kitty(&#123;</span><br><span class="line">        genes: _genes,</span><br><span class="line">        birthTime: uint64(now),</span><br><span class="line">        cooldownEndBlock: <span class="number">0</span>,</span><br><span class="line">        matronId: uint32(_matronId),</span><br><span class="line">        sireId: uint32(_sireId),</span><br><span class="line">        siringWithId: <span class="number">0</span>,</span><br><span class="line">        cooldownIndex: cooldownIndex,</span><br><span class="line">        generation: uint16(_generation)</span><br><span class="line">    &#125;);</span><br><span class="line">    uint256 newKittenId = kitties.push(_kitty) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// It's probably never going to happen, 4 billion cats is A LOT, but</span></span><br><span class="line">    <span class="comment">// let's just be 100% sure we never let this happen.</span></span><br><span class="line">    <span class="built_in">require</span>(newKittenId == uint256(uint32(newKittenId)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// emit the birth event</span></span><br><span class="line">    Birth(</span><br><span class="line">        _owner,</span><br><span class="line">        newKittenId,</span><br><span class="line">        uint256(_kitty.matronId),</span><br><span class="line">        uint256(_kitty.sireId),</span><br><span class="line">        _kitty.genes</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This will assign ownership, and also emit the Transfer event as</span></span><br><span class="line">    <span class="comment">// per ERC721 draft</span></span><br><span class="line">    _transfer(<span class="number">0</span>, _owner, newKittenId);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newKittenId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以这个方法传递了父亲跟母亲的ID，这只猫的世代编号，256位基因密码，以及拥有着的地址。接着创造了这只猫，将这只猫的数据推送到主猫咪数组，接着调用了_transfer()方法将它指派给它的新拥有着。</p>
<p>==很酷吧 - 所以现在我们明白了加密猫游戏如何将一只猫咪定义成一个数据类型，怎么将所有猫咪存储在区块链上，并且如何追踪谁拥有这些猫咪。==</p>
<h3><span id="3-kittyownership合约-猫咪即代币">3. KittyOwnership合约: 猫咪即代币</span></h3><p><em>这个合约为基本的不可互换的代币交易提供了方法，符合ERC-721代币标准草案</em></p>
<p>加密猫符合ERC721代币标准，一个==不可互换==的代币类型使它自己能更好的追踪数字收藏品的所有权，就像数字卡牌游戏或者MMORPG里的稀有物品。</p>
<p>注意==可互换性==: 以太是可互换的，因为任意5ETH跟其它任意5ETH是一样的。但不可互换代币如以太猫，不是每一只猫都是平等的，所以它们互相之间都是不可替换的。</p>
<p>你能看到从它的合约定义里面，KittyOwnership是从ERC721合约继承下来的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract KittyOwnership is KittyBase, ERC721 &#123;</span><br></pre></td></tr></table></figure></p>
<p>并且所有ERC721代币遵循同样的标准规范，所以KittyOwnership合约实现了如下方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @title Interface for contracts conforming to ERC-721: Non-Fungible Tokens</span></span><br><span class="line"><span class="comment">/// @author Dieter Shirley &lt;dete@axiomzen.co&gt; (https://github.com/dete)</span></span><br><span class="line">contract ERC721 &#123;</span><br><span class="line">    <span class="comment">// Required methods</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">totalSupply</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 total</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 balance</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address owner</span>);</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">external</span>;</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">external</span>;</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">transferFrom</span>(<span class="params">address _from, address _to, uint256 _tokenId</span>) <span class="title">external</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    // <span class="title">Events</span></span></span><br><span class="line"><span class="function">    <span class="title">event</span> <span class="title">Transfer</span>(<span class="params">address from, address to, uint256 tokenId</span>);</span></span><br><span class="line"><span class="function">    <span class="title">event</span> <span class="title">Approval</span>(<span class="params">address owner, address approved, uint256 tokenId</span>);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    // <span class="title">Optional</span></span></span><br><span class="line"><span class="function">    // <span class="title">function</span> <span class="title">name</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">string name</span>);</span></span><br><span class="line"><span class="function">    // <span class="title">function</span> <span class="title">symbol</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">string symbol</span>);</span></span><br><span class="line"><span class="function">    // <span class="title">function</span> <span class="title">tokensOfOwner</span>(<span class="params">address _owner</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256[] tokenIds</span>);</span></span><br><span class="line"><span class="function">    // <span class="title">function</span> <span class="title">tokenMetadata</span>(<span class="params">uint256 _tokenId, string _preferredTransport</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">string infoUrl</span>);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    // <span class="title">ERC</span>-165 <span class="title">Compatibility</span> (<span class="params">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/ethereum/</span>EIPs<span class="regexp">/issues/</span><span class="number">165</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">function</span> <span class="title">supportsInterface</span>(<span class="params">bytes4 _interfaceID</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">bool</span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>因为所有的方法都是public的，这提供了一种标准的方式给用户来与加密猫代币打交道，就像它们操作其它符合ERC721标准的代币。你能转移你的代币到其它用户通过直接在以太坊的区块链上操作加密猫的合约而不需要通过它们的web界面，这就意味这你真正拥有你的猫咪（除非CEO暂停这些合同）。</p>
<p>这里不一一探讨所有方法的实现了，但你可以直接在EthFiddle上搜索KittyOwnership。</p>
<hr>
<h3><span id="中场休息想创建一个你自己的以太坊游戏">中场休息：想创建一个你自己的以太坊游戏？</span></h3><p>这篇文章第一次发布的时候收到了大量的正面反馈，所以我们创建了<a href="https://cryptozombies.io/" target="_blank" rel="noopener">CryptoZombies</a>加密僵尸：一个教你在以太坊上创建自己的游戏的互动教程。它会叫你一步步的学习Solidity编码，并且创建你自己的以太坊游戏。如果你喜欢这篇文章，可以去查阅一下。</p>
<hr>
<h3><span id="4-kittybreeding合约让猫咪变得污起来">4. KittyBreeding合约：让猫咪变得污起来</span></h3><p><em>这个文件包括了让猫咪在一起繁殖的必要方法，包括为繁衍提供追踪，以及依赖一个外部的基因组合合约。</em></p>
<p>这个“外部的基因组合合约（基因科学）geneScience被存储在一个单独的合约中，这个合约不是开源的。</p>
<p>KittyBreeding合约为CEO包装了一个方法用来设置这个外部合约：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @dev Update the address of the genetic contract, can only be called by the CEO.</span></span><br><span class="line"><span class="comment">/// @param _address An address of a GeneScience contract instance to be used from this point forward.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setGeneScienceAddress</span>(<span class="params">address _address</span>) <span class="title">external</span> <span class="title">onlyCEO</span> </span>&#123;</span><br><span class="line">    GeneScienceInterface candidateContract = GeneScienceInterface(_address);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> verify that a contract is what we expect - https://github.com/Lunyr/crowdsale-contracts/blob/cfadd15986c30521d8ba7d5b6f57b4fefcc7ac38/contracts/LunyrToken.sol#L117</span></span><br><span class="line">    <span class="built_in">require</span>(candidateContract.isGeneScience());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the new contract address</span></span><br><span class="line">    geneScience = candidateContract;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>他们这样做让这个游戏变得不那么简单 - 如果你能读懂一只猫的DNA是如何决定的，也就会很容易知道哪些猫在一起繁殖可以产生牛逼的品种。</p>
<p>这个外部基因科学合约geneScience后面被用在giveBirth()函数用来决定新猫咪的DNA。</p>
<p>现在我们来看一看当两只猫在一起繁殖会发生什么：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/// @dev Internal utility function to initiate breeding, assumes that all breeding</span><br><span class="line">///  requirements have been checked.</span><br><span class="line">function _breedWith(uint256 _matronId, uint256 _sireId) internal &#123;</span><br><span class="line">    // Grab a reference to the Kitties from storage.</span><br><span class="line">    Kitty storage sire = kitties[_sireId];</span><br><span class="line">    Kitty storage matron = kitties[_matronId];</span><br><span class="line"></span><br><span class="line">    // Mark the matron as pregnant, keeping track of who the sire is.</span><br><span class="line">    matron.siringWithId = uint32(_sireId);</span><br><span class="line"></span><br><span class="line">    // Trigger the cooldown for both parents.</span><br><span class="line">    _triggerCooldown(sire);</span><br><span class="line">    _triggerCooldown(matron);</span><br><span class="line"></span><br><span class="line">    // Clear siring permission for both parents. This may not be strictly necessary</span><br><span class="line">    // but it&apos;s likely to avoid confusion!</span><br><span class="line">    delete sireAllowedToAddress[_matronId];</span><br><span class="line">    delete sireAllowedToAddress[_sireId];</span><br><span class="line"></span><br><span class="line">    // Every time a kitty gets pregnant, counter is incremented.</span><br><span class="line">    pregnantKitties++;</span><br><span class="line"></span><br><span class="line">    // Emit the pregnancy event.</span><br><span class="line">    Pregnant(kittyIndexToOwner[_matronId], _matronId, _sireId, matron.cooldownEndBlock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法拿到了母亲跟父亲的ID，然后在主猫咪数组里查找到他们的实例，并将母亲的siringWithId设置成父亲的ID（当siringWithId为非零的时候，就知道这个母系猫已经怀孕）。</p>
<p>这个方法同样在父母猫上执行了triggerCooldown方法，用来使这两只猫无法在一段时间内继续繁殖，冷却一下。</p>
<p>接着，我们有一个giveBirth()方法用来创建一直新的猫咪：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @notice Have a pregnant Kitty give birth!</span></span><br><span class="line"><span class="comment">/// @param _matronId A Kitty ready to give birth.</span></span><br><span class="line"><span class="comment">/// @return The Kitty ID of the new kitten.</span></span><br><span class="line"><span class="comment">/// @dev Looks at a given Kitty and, if pregnant and if the gestation period has passed,</span></span><br><span class="line"><span class="comment">///  combines the genes of the two parents to create a new kitten. The new Kitty is assigned</span></span><br><span class="line"><span class="comment">///  to the current owner of the matron. Upon successful completion, both the matron and the</span></span><br><span class="line"><span class="comment">///  new kitten will be ready to breed again. Note that anyone can call this function (if they</span></span><br><span class="line"><span class="comment">///  are willing to pay the gas!), but the new kitten always goes to the mother's owner.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">giveBirth</span>(<span class="params">uint256 _matronId</span>)</span></span><br><span class="line"><span class="function">    <span class="title">external</span></span></span><br><span class="line"><span class="function">    <span class="title">whenNotPaused</span></span></span><br><span class="line"><span class="function">    <span class="title">returns</span>(<span class="params">uint256</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Grab a reference to the matron in storage.</span></span><br><span class="line">    Kitty storage matron = kitties[_matronId];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check that the matron is a valid cat.</span></span><br><span class="line">    <span class="built_in">require</span>(matron.birthTime != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check that the matron is pregnant, and that its time has come!</span></span><br><span class="line">    <span class="built_in">require</span>(_isReadyToGiveBirth(matron));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Grab a reference to the sire in storage.</span></span><br><span class="line">    uint256 sireId = matron.siringWithId;</span><br><span class="line">    Kitty storage sire = kitties[sireId];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine the higher generation number of the two parents</span></span><br><span class="line">    uint16 parentGen = matron.generation;</span><br><span class="line">    <span class="keyword">if</span> (sire.generation &gt; matron.generation) &#123;</span><br><span class="line">        parentGen = sire.generation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Call the sooper-sekret gene mixing operation.</span></span><br><span class="line">    uint256 childGenes = geneScience.mixGenes(matron.genes, sire.genes, matron.cooldownEndBlock - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make the new kitten!</span></span><br><span class="line">    address owner = kittyIndexToOwner[_matronId];</span><br><span class="line">    uint256 kittenId = _createKitty(_matronId, matron.siringWithId, parentGen + <span class="number">1</span>, childGenes, owner);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Clear the reference to sire from the matron (REQUIRED! Having siringWithId</span></span><br><span class="line">    <span class="comment">// set is what marks a matron as being pregnant.)</span></span><br><span class="line">    <span class="keyword">delete</span> matron.siringWithId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Every time a kitty gives birth counter is decremented.</span></span><br><span class="line">    pregnantKitties--;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Send the balance fee to the person who made birth happen.</span></span><br><span class="line">    msg.sender.send(autoBirthFee);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return the new kitten's ID</span></span><br><span class="line">    <span class="keyword">return</span> kittenId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码内的注释信息已经解释的非常好了。基本上，这段代码首先执行了一些检测来判断母亲猫是否已经准备好生产。然后用geneScience.mixGenes()方法来决定孩子的基因，指定了新生猫咪的所有权为母亲猫的主人，最后调用在KittyBase里看到过的_createKitty()函数。<br>请注意geneScience.mixGenes()函数是一个黑盒不可见的函数，因为该协议（geneScience）是一个闭源协议。所以我们并不知道孩子猫的基因是如何决定的，但我们知道该函数是通过计算参数：母亲的基因，父亲的基因以及母亲的cooldownEndBlock来运转的。</p>
<h3><span id="5-kittyauctions-猫咪拍卖协议-购买出售猫咪让猫咪去接客拉皮条">5. KittyAuctions 猫咪拍卖协议: 购买，出售猫咪，让猫咪去接客，拉皮条</span></h3><p><em>在这儿我们有一些public的方法用来拍卖或者竞标猫咪或者是配种服务。事实上拍卖功能由两种兄弟协议来掌控（一个是买卖，一个是配种），然而拍卖跟竞标主要是通过核心合约层面</em></p>
<p>根据开发介绍，他们将拍卖功能分割成sibling合约是由于“他们的逻辑优点复杂，有一些产生比较微妙的bug的风险。因此通过在它们各自的合约里，我们能够升级这些合约而不用扰乱用来追踪猫咪所有权的主要合约。”</p>
<p>所以这个KittyAuctions合约包含了如下的方法：<br><figure class="highlight plain"><figcaption><span>```setGeneScienceAddress()``` 一样只能被CEO调用，这些地址将被设置为外部合约。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*注意：“Siring”是指让你的猫去拉皮条，去卖，这样另外的用户就可以支付给你以太坊让你们的猫在一起干羞羞的事情。*</span><br><span class="line"></span><br><span class="line">这就意味着即使加密猫合同本身是不可变的，但CEO有灵活性去改变拍卖合同后面的地址，这将会改变拍卖的规则。再次强调，未必不是一件好事，因为有些时候开发人员需要去修正bug，但这一块是需要注意的地方。</span><br><span class="line"></span><br><span class="line">我将不会继续深入介绍拍卖跟竞标逻辑，但你能从EthFiddle上查阅这部分代码（搜索KittyAuctions）。</span><br><span class="line"></span><br><span class="line">### 6. KittyMinting 猫咪铸币： 初代猫咪工厂 </span><br><span class="line"></span><br><span class="line">*这是最后一块内容，包含了我们用来创建新的gen0猫咪。我们创造了5000只“推广”猫用来赠送（特别是当社区刚刚创建的时候），而其它所有的猫都只能被创建，然后通过一个指定的算法来设置一个初始价格然后就拉上去拍卖了。不管他们是如何创建的，他们都是被硬限制总数为50000只的初代猫。打那之后，一切由整个社区来继续繁殖，繁殖，繁殖！*</span><br><span class="line"></span><br><span class="line">赠送猫跟初代猫被硬编码在合约里：</span><br></pre></td></tr></table></figure></p>
<p>uint256 public constant PROMO_CREATION_LIMIT = 5000;<br>uint256 public constant GEN0_CREATION_LIMIT = 45000;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">接着这段代码是首席运营官COO用来创建赠送猫跟初代猫咪的：</span><br><span class="line">```javascript</span><br><span class="line">/// @dev we can create promo kittens, up to a limit. Only callable by COO</span><br><span class="line">/// @param _genes the encoded genes of the kitten to be created, any value is accepted</span><br><span class="line">/// @param _owner the future owner of the created kittens. Default to contract COO</span><br><span class="line">function createPromoKitty(uint256 _genes, address _owner) external onlyCOO &#123;</span><br><span class="line">    address kittyOwner = _owner;</span><br><span class="line">    if (kittyOwner == address(0)) &#123;</span><br><span class="line">         kittyOwner = cooAddress;</span><br><span class="line">    &#125;</span><br><span class="line">    require(promoCreatedCount &lt; PROMO_CREATION_LIMIT);</span><br><span class="line"></span><br><span class="line">    promoCreatedCount++;</span><br><span class="line">    _createKitty(0, 0, 0, _genes, kittyOwner);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/// @dev Creates a new gen0 kitty with the given genes and</span><br><span class="line">///  creates an auction for it.</span><br><span class="line">function createGen0Auction(uint256 _genes) external onlyCOO &#123;</span><br><span class="line">    require(gen0CreatedCount &lt; GEN0_CREATION_LIMIT);</span><br><span class="line"></span><br><span class="line">    uint256 kittyId = _createKitty(0, 0, 0, _genes, address(this));</span><br><span class="line">    _approve(kittyId, saleAuction);</span><br><span class="line"></span><br><span class="line">    saleAuction.createAuction(</span><br><span class="line">        kittyId,</span><br><span class="line">        _computeNextGen0Price(),</span><br><span class="line">        0,</span><br><span class="line">        GEN0_AUCTION_DURATION,</span><br><span class="line">        address(this)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    gen0CreatedCount++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过createPromoKitty()，看上去COO能够根据他自己的想法创建出新的猫咪，address参数表明COO能将这些猫咪送个他像送的人。我猜测这些人是早期beta测试人员，朋友以及家人，免费送给他们猫咪用来帮助推广产品，诸如此类。</p>
<p>但这同样意味着你的猫可能不如你想象的那么独一无二，因为他能暗中打印5000个相同的副本！<br>对于createGen0Auction(), COO同样提供了遗传代码给新的猫咪。但不同于将其分配给一个特定用户的地址，该方法创建了一个拍卖活动使得用户通过以太坊来竞拍得到这只猫咪。</p>
<h3><span id="7-kittycore-猫咪核心最主要的合约">7. KittyCore 猫咪核心：最主要的合约</span></h3><p>这是最主要的加密猫合约，是可以编译并且运行在以太坊区块链上的。这份合约将其它所有东西绑在一起。</p>
<p>因为继承结构的原因，它继承了前面所有合约，添加了一些少量的最终方法，比如这个通过猫咪的ID来获取一只猫咪的所有数据的函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// @notice Returns all the relevant information about a specific kitty.</span></span><br><span class="line"><span class="comment">/// @param _id The ID of the kitty of interest.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getKitty</span>(<span class="params">uint256 _id</span>)</span></span><br><span class="line"><span class="function">    <span class="title">external</span></span></span><br><span class="line"><span class="function">    <span class="title">view</span></span></span><br><span class="line"><span class="function">    <span class="title">returns</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    bool isGestating,</span></span></span><br><span class="line"><span class="function"><span class="params">    bool isReady,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 cooldownIndex,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 nextActionAt,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 siringWithId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 birthTime,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 matronId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 sireId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 generation,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 genes</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">    Kitty storage kit = kitties[_id];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if this variable is 0 then it's not gestating</span></span><br><span class="line">    isGestating = (kit.siringWithId != <span class="number">0</span>);</span><br><span class="line">    isReady = (kit.cooldownEndBlock &lt;= block.number);</span><br><span class="line">    cooldownIndex = uint256(kit.cooldownIndex);</span><br><span class="line">    nextActionAt = uint256(kit.cooldownEndBlock);</span><br><span class="line">    siringWithId = uint256(kit.siringWithId);</span><br><span class="line">    birthTime = uint256(kit.birthTime);</span><br><span class="line">    matronId = uint256(kit.matronId);</span><br><span class="line">    sireId = uint256(kit.sireId);</span><br><span class="line">    generation = uint256(kit.generation);</span><br><span class="line">    genes = kit.genes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是一个public的方法将从区块链上返回一只指定猫咪的所有数据。我猜想这可能是他们的web服务器用来做查询，从而显示猫咪在网站上的接口。</p>
<p>等等… 我并没有看到任何图像数据。到底是什么决定了一只猫咪的外观？</p>
<p>正如我们看到的代码一样，一只猫咪基本上是由一串256位无符号整形数来表示它的基因代码的。</p>
<p>Solidity合约代码中没有任何东西可以储存一只猫的图片，或者关于猫的描述。那到底什么来决定这个256位整形数到底是什么含义呢？其实基因代码是由加密猫的web服务器来进行翻译的。</p>
<p>所以尽管这真是一个聪明的区块链游戏的示范，但事实上它不是100%基于区块链技术的。如果他们的网站在未来离线了，除非有人备份了所有的图像，你将只能拥有一个毫无意义的256位整形数。</p>
<p>在合约代码里，我找到了一个合约名为ERC721Metadata，但它从未使用过。所以我猜测的是他们原本计划存储所有的数据在区块链上，但后来决定不这样搞了（存储大量数据在以太网上开销太大？）所以他们最后用web服务器来存储数据作为替代。</p>
<h3><span id="总结">总结</span></h3><p>好了，总而言之，我们已经看了如下内容：</p>
<ul>
<li>猫咪是如何被定义成数据的</li>
<li>所有的存在的猫咪是如何被保存在单个智能合约里的，并且展示了如何来跟踪“谁拥有什么”</li>
<li>gen0初代猫是如何诞生的</li>
<li>猫咪如何在一起繁殖产生新的猫咪</li>
</ul>
<p>这只是一个顶层概述。如果你在寻找一个更加深入的教程关于如何创建你自己的游戏，你可能会对我们接下来几周发布的互动代码课程感兴趣。</p>
<p>更新：我们发布了这个课程。请前往：<br><a href="https://cryptozombies.io" target="_blank" rel="noopener">https://cryptozombies.io</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/28/创建你自己的加密货币/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="李工">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="看区块">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/28/创建你自己的加密货币/" itemprop="url">创建你自己的加密货币【官方文档翻译】</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-28T14:39:21+08:00">
                2018-02-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.ethereum.org/token" target="_blank" rel="noopener">https://www.ethereum.org/token</a> </p>
<p><strong>李工翻译，转载请注明出处</strong></p>
<h2><span id="代币">代币</span></h2><p>我们将要创建一个数字代币。代币在以太坊的生态系统中能代表任何可替代（以太坊的替代与不可替代定义，两两之间可以互换不存在差异）的交易物品：金币，忠诚点数，金币券，欠条，游戏内物品，等等。因为所有的代币以一种标准方式实现了基础的功能，这同样意味着你的代币能够立马被以太坊钱包与其它任何使用该标准的客户端或者合约所兼容。</p>
<h3><span id="最小可行代币">最小可行代币</span></h3><p>标准代币合约可能会比较复杂。但本质上一个非常基础的代币可以归结为这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">contract MyToken &#123;</span><br><span class="line">    <span class="comment">/* This creates an array with all balances */</span></span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initializes contract with initial supply tokens to the creator of the contract */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">MyToken</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        uint256 initialSupply</span></span></span><br><span class="line"><span class="function"><span class="params">        </span>) </span>&#123;</span><br><span class="line">        balanceOf[msg.sender] = initialSupply;              <span class="comment">// Give the creator all initial tokens</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Send coins */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.sender] &gt;= _value);           <span class="comment">// Check if the sender has enough</span></span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_to] + _value &gt;= balanceOf[_to]); <span class="comment">// Check for overflows</span></span><br><span class="line">        balanceOf[msg.sender] -= _value;                    <span class="comment">// Subtract from the sender</span></span><br><span class="line">        balanceOf[_to] += _value;                           <span class="comment">// Add the same to the recipient</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="代码">代码</span></h3><p>如果你想拷贝粘贴一个更加完整的代码，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.16</span>;</span><br><span class="line"></span><br><span class="line">interface tokenRecipient &#123; <span class="function"><span class="keyword">function</span> <span class="title">receiveApproval</span>(<span class="params">address _from, uint256 _value, address _token, bytes _extraData</span>) <span class="title">public</span>; &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">contract</span> <span class="title">TokenERC20</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Public variables of the token</span></span><br><span class="line">    string public name;</span><br><span class="line">    string public symbol;</span><br><span class="line">    uint8 public decimals = <span class="number">18</span>;</span><br><span class="line">    <span class="comment">// 18 decimals is the strongly suggested default, avoid changing it</span></span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This creates an array with all balances</span></span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This generates a public event on the blockchain that will notify clients</span></span><br><span class="line">    event Transfer(address indexed <span class="keyword">from</span>, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This notifies clients about the amount burnt</span></span><br><span class="line">    event Burn(address indexed <span class="keyword">from</span>, uint256 value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructor function</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Initializes contract with initial supply tokens to the creator of the contract</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">TokenERC20</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        uint256 initialSupply,</span></span></span><br><span class="line"><span class="function"><span class="params">        string tokenName,</span></span></span><br><span class="line"><span class="function"><span class="params">        string tokenSymbol</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        totalSupply = initialSupply * <span class="number">10</span> ** uint256(decimals);  <span class="comment">// Update total supply with the decimal amount</span></span><br><span class="line">        balanceOf[msg.sender] = totalSupply;                <span class="comment">// Give the creator all initial tokens</span></span><br><span class="line">        name = tokenName;                                   <span class="comment">// Set the name for display purposes</span></span><br><span class="line">        symbol = tokenSymbol;                               <span class="comment">// Set the symbol for display purposes</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Internal transfer, only can be called by this contract</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint _value</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Prevent transfer to 0x0 address. Use burn() instead</span></span><br><span class="line">        <span class="built_in">require</span>(_to != <span class="number">0x0</span>);</span><br><span class="line">        <span class="comment">// Check if the sender has enough</span></span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_from] &gt;= _value);</span><br><span class="line">        <span class="comment">// Check for overflows</span></span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_to] + _value &gt; balanceOf[_to]);</span><br><span class="line">        <span class="comment">// Save this for an assertion in the future</span></span><br><span class="line">        uint previousBalances = balanceOf[_from] + balanceOf[_to];</span><br><span class="line">        <span class="comment">// Subtract from the sender</span></span><br><span class="line">        balanceOf[_from] -= _value;</span><br><span class="line">        <span class="comment">// Add the same to the recipient</span></span><br><span class="line">        balanceOf[_to] += _value;</span><br><span class="line">        Transfer(_from, _to, _value);</span><br><span class="line">        <span class="comment">// Asserts are used to use static analysis to find bugs in your code. They should never fail</span></span><br><span class="line">        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transfer tokens</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Send `_value` tokens to `_to` from your account</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _to The address of the recipient</span></span><br><span class="line"><span class="comment">     * @param _value the amount to send</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        _transfer(msg.sender, _to, _value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transfer tokens from other address</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Send `_value` tokens to `_to` on behalf of `_from`</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _from The address of the sender</span></span><br><span class="line"><span class="comment">     * @param _to The address of the recipient</span></span><br><span class="line"><span class="comment">     * @param _value the amount to send</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transferFrom</span>(<span class="params">address _from, address _to, uint256 _value</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(_value &lt;= allowance[_from][msg.sender]);     <span class="comment">// Check allowance</span></span><br><span class="line">        allowance[_from][msg.sender] -= _value;</span><br><span class="line">        _transfer(_from, _to, _value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set allowance for other address</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Allows `_spender` to spend no more than `_value` tokens on your behalf</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _spender The address authorized to spend</span></span><br><span class="line"><span class="comment">     * @param _value the max amount they can spend</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _spender, uint256 _value</span>) <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        allowance[msg.sender][_spender] = _value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set allowance for other address and notify</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Allows `_spender` to spend no more than `_value` tokens on your behalf, and then ping the contract about it</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _spender The address authorized to spend</span></span><br><span class="line"><span class="comment">     * @param _value the max amount they can spend</span></span><br><span class="line"><span class="comment">     * @param _extraData some extra information to send to the approved contract</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">approveAndCall</span>(<span class="params">address _spender, uint256 _value, bytes _extraData</span>)</span></span><br><span class="line"><span class="function">        <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        tokenRecipient spender = tokenRecipient(_spender);</span><br><span class="line">        <span class="keyword">if</span> (approve(_spender, _value)) &#123;</span><br><span class="line">            spender.receiveApproval(msg.sender, _value, <span class="keyword">this</span>, _extraData);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Destroy tokens</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Remove `_value` tokens from the system irreversibly</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _value the amount of money to burn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">burn</span>(<span class="params">uint256 _value</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.sender] &gt;= _value);   <span class="comment">// Check if the sender has enough</span></span><br><span class="line">        balanceOf[msg.sender] -= _value;            <span class="comment">// Subtract from the sender</span></span><br><span class="line">        totalSupply -= _value;                      <span class="comment">// Updates totalSupply</span></span><br><span class="line">        Burn(msg.sender, _value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Destroy tokens from other account</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _from the address of the sender</span></span><br><span class="line"><span class="comment">     * @param _value the amount of money to burn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">burnFrom</span>(<span class="params">address _from, uint256 _value</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_from] &gt;= _value);                <span class="comment">// Check if the targeted balance is enough</span></span><br><span class="line">        <span class="built_in">require</span>(_value &lt;= allowance[_from][msg.sender]);    <span class="comment">// Check allowance</span></span><br><span class="line">        balanceOf[_from] -= _value;                         <span class="comment">// Subtract from the targeted balance</span></span><br><span class="line">        allowance[_from][msg.sender] -= _value;             <span class="comment">// Subtract from the sender's allowance</span></span><br><span class="line">        totalSupply -= _value;                              <span class="comment">// Update totalSupply</span></span><br><span class="line">        Burn(_from, _value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="理解代码">理解代码</span></h3><p><img src="https://www.ethereum.org/images/tutorial/deploy-new-contract.png" alt="image"></p>
<p>让我们开始基础部分。打开钱包应用，去到<em>合约</em>页面然后点击<em>部署新合约</em>。在<em>SOLIDITY合约原始代码</em>，输入以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contract MyToken &#123;</span><br><span class="line">    <span class="comment">/* This creates an array with all balances */</span></span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mapping映射关键字是指一个关联数组，用来关联用户地址跟余额。address地址是以太坊的基础十六进制格式，余额是整形数，范围从0到115quattuorvigintillion（乘以10的75次方）。如果你不知道quattuorvigintillion有多少，是很多vigintillions反正比你计划使用的代币总数多得多。public关键字，意味着这个变量可以被区块链上的任何人访问到，意味着所有的余额都是公开的（需要这样做，这样所有的客户端都可以显示这些数量）。</p>
<p><img src="https://www.ethereum.org/images/tutorial/edit-contract.png" alt="image"></p>
<p>如果你马上发布你的合约，它将开始工作但不会那么有效果：它是一个能够查询任何保存了你的代币余额的地址的合约，但你还没有创建任何一个代币，所以数组里的任何一组值都将返回0。所以我们将在合约启动的时候创建一些代币。在mapping下添加这些代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyToken</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    balanceOf[msg.sender] = <span class="number">21000000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意MyToken函数拥有跟合约一样的名称MyToken。这是非常重要的，如果你想重命名其中的一个，另一个名字也必须重新命名：这是很特别的，启动函数只运行一次，当且仅当合约被第一次上传发布到网络中。这个函数会设置msg.sender地址的余额数，msg.sender就是部署这个合约的用户，余额被设置为2100万。</p>
<p>选择2100万是随意的，在代码中你自己能改成任意数目，但这儿有一个更好的方式：将这个数量作为函数的参数传进来，就像这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyToken</span>(<span class="params">uint256 initialSupply</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    balanceOf[msg.sender] = initialSupply;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看一看合约代码右侧的下拉菜单，写着选择合约。选择“MyToken”合约后，你会看到现在这里显示了一个叫做构造函数参数的区域。他们是你合约里可以改变的参数，因此在未来你可以重用同样的合约代码只需要改变这些参数。</p>
<p><img src="https://www.ethereum.org/images/tutorial/function-picker.png" alt="image"></p>
<p>现在你有了一个合约可以创建代币的余额但还没有任何的函数能够转移它们，它们所能做的就是呆在同样的账户里。因此我们将实现转移函数。输入以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Send coins */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* Add and subtract new balances */</span></span><br><span class="line">    balanceOf[msg.sender] -= _value;</span><br><span class="line">    balanceOf[_to] += _value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个非常明确的函数：它有一个接收者跟一个value值作为参数，无论何时当用户调用这个函数，它将从用户的余额中减去_value，并且加到_to地址的余额里。现在这有一个明显的问题：假如用户想发送超过他们额度的代币呢？因此我们不想在这个合约里来处理债务的问题，所以我们简单的快速检查一下如果用户的资金不够那么合同的执行就会停止。同样要检查以下溢出，避免一个很大的数出现后溢出，账户的余额变成0。</p>
<p>在合约的执行过程中停止一个合约的执行你能使用<strong>return</strong>跟<strong>throw</strong>，这种形式会花费很少的gas但会让人头疼，因为你对合约所做的任何改变都会被保存。另一方面，‘throw’会终止所有合约的执行，恢复所有交易做出的改变，并且调用者会损失这些gas。但因为钱包会侦测到一个合约会出现throw，它会显示一个警告，防止任何以太被花费。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* Check if sender has balance and for overflows */</span></span><br><span class="line">    <span class="built_in">require</span>(balanceOf[msg.sender] &gt;= _value &amp;&amp; balanceOf[_to] + _value &gt;= balanceOf[_to]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Add and subtract new balances */</span></span><br><span class="line">    balanceOf[msg.sender] -= _value;</span><br><span class="line">    balanceOf[_to] += _value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在缺少一些合同的基本的信息。在未来这些信息能够在代币注册中编辑到，但现在我们将它们直接添加到合约中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string public name;</span><br><span class="line">string public symbol;</span><br><span class="line">uint8 public decimals;</span><br></pre></td></tr></table></figure>
<p>现在我们更新构造函数来允许所有这些变量能够在初始化的时候被设置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Initializes contract with initial supply tokens to the creator of the contract */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyToken</span>(<span class="params">uint256 initialSupply, string tokenName, string tokenSymbol, uint8 decimalUnits</span>) </span>&#123;</span><br><span class="line">    balanceOf[msg.sender] = initialSupply;              <span class="comment">// Give the creator all initial tokens</span></span><br><span class="line">    name = tokenName;                                   <span class="comment">// Set the name for display purposes</span></span><br><span class="line">    symbol = tokenSymbol;                               <span class="comment">// Set the symbol for display purposes</span></span><br><span class="line">    decimals = decimalUnits;                            <span class="comment">// Amount of decimals for display purposes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，我们现在需要某些叫做时间Events的东西。它们是特殊的，空的方法，你能调用来帮助客户端比如以太坊钱包来跟踪合约的活动事件。事件应该由一个大写字母开头。将这行代码添加到合约的开始处来声明这个事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event Transfer(address indexed <span class="keyword">from</span>, address indexed to, uint256 value);</span><br></pre></td></tr></table></figure>
<p>现在你只需要增加两行在transfer函数里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Notify anyone listening that this transfer took place */</span></span><br><span class="line">Transfer(msg.sender, _to, _value);</span><br></pre></td></tr></table></figure>
<p>现在你的代币已经准备好了！</p>
<h3><span id="注意到了注释">注意到了注释？</span></h3><p>那些@notice与@param注释是什么意思呢？你可能会问。那是自然语言定义的一些新的标准，用来让钱包显示给用户一个自然语言的描述来解释合约的用途。尽管当前还没有被很多钱包所支持，但未来会有所改变，所以最好还是加上。</p>
<h3><span id="如何部署合约">如何部署合约</span></h3><p>如果还没有准备好，打开以太坊钱包，去到合约页面点击“部署新合约”</p>
<p>现在从上面获取代币的源代码粘贴进“SOLIDITY源代码区域”。如果代码的编译没有任何错误，你应该会看到右侧的一个“选择合约”下拉列表。选择“MyToken”合约。在右侧，你将看到所有你的代币的个性化定制参数。你能随意调整它们，但根据这篇教程的意图，我们推荐你使用以下参数：总数设为10000，代币的名字随意，%为标志，2个小数位。你的钱包应该这样显示：</p>
<p><img src="https://www.ethereum.org/images/tutorial/Ethereum-Wallet-Screenshot-2015-12-03-at-3.50.36-PM-10.png" alt="image"></p>
<p>滚动到页面的底部你会看到部署合约的估算价格，你可以选择你自己想支付的费用。任何多余的以太坊将会返还给你，如果你愿意的话，你可以使用默认的设置。点击“部署”，输入你的账户密码等待一会，你的交易将被记录。</p>
<p><img src="https://www.ethereum.org/images/tutorial/Ethereum-Wallet-Screenshot-2015-12-03-at-3.50.36-PM-11.png" alt="image"></p>
<p>然后钱包会跳转到前面的页面，你能够看到你的交易正在等待确认。点击账户“Etherbase”（你的主账户），一分钟后你会看到你的账户拥有你刚刚创建的100%代币份额。发送一些给你的朋友：选择“发送”，选择哪种货币你希望发送（以太坊或者你刚刚创建的），粘贴你朋友的地址到“发送至”区域然后点击“发送”。</p>
<p><img src="https://www.ethereum.org/images/tutorial/Screen-Shot-2015-12-03-at-9.48.15-AM.png" alt="image"></p>
<p>如果你发送了代币给你的朋友，他们在钱包里是看不到任何东西的。因为你必须手动的添加。现在去到“合约”页面你会看到你刚刚创建的合约的链接。点击它进入一个合约页面，这是一个非常简单的合约页面，点击“复制地址”粘贴到文本编辑器里，等会会需要这个。</p>
<p>添加一个代币来观察，进入合约页面点击“查看代币”。出现一个弹出窗口，你只需要粘贴合约地址。代币的名字，缩写符号跟小数位会自动填充进来。如果没有自动填写，你可以修改成任意你想要的值（只是会影响你自己的钱包怎么显示）。一旦你完成这些，你就能够自动的显示这些代币的余额同时你能够发送它们给任何其他人。</p>
<p><img src="https://www.ethereum.org/images/tutorial/Screen-Shot-2015-12-03-at-9.44.42-AM.png" alt="image"></p>
<p>现在你拥有了你自己的加密代币！代币本身能够被用作本地社区的价值交换，比如作为追踪工人的工作时间与其它绩效考核项目。但我们可以让一个货币拥有自己的价值使它更有用？</p>
<h2><span id="改进你的代币">改进你的代币</span></h2><p>你能够发布你的加密货币而不需要碰任何一行代码，但真正的魔力在于当你开始定制这些代币。下面这段内容将会是一些建议关于增加你的代币的功能来满足你的更多需求。</p>
<h2><span id="更多基础功能">更多基础功能</span></h2><p>你会注意到这儿有一些其它的方法在你的代币合约中，比如approve，sendFrom与其它。这些函数在那帮助你的代币与其它合约进行交互：如果你希望这样，比如说，卖一些代币给一个去中心化的交易所，只是发送给他们一个地址是不够的，因为交易所不会意识到新的代币或者是谁发送它们，因为合约不能通过<strong>订阅事件</strong>来调用函数。所以对于合约，你应该首先批准它们能转移的代币数量然后ping通知他们让他们知道他们应该做自己的事情或者将这两个动作合二为一，叫做<strong>approveAndCall</strong>。</p>
<p>因为许多函数都将不得不重新实现代币的传输，将其变为内部函数是有意义的，这样智能被合约自己内部调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Internal transfer, can only be called by this contract */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint _value</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span> (_to != <span class="number">0x0</span>);                               <span class="comment">// Prevent transfer to 0x0 address. Use burn() instead</span></span><br><span class="line">    <span class="built_in">require</span> (balanceOf[_from] &gt;= _value);                <span class="comment">// Check if the sender has enough</span></span><br><span class="line">    <span class="built_in">require</span> (balanceOf[_to] + _value &gt; balanceOf[_to]); <span class="comment">// Check for overflows</span></span><br><span class="line">    <span class="built_in">require</span>(!frozenAccount[_from]);                     <span class="comment">// Check if sender is frozen</span></span><br><span class="line">    <span class="built_in">require</span>(!frozenAccount[_to]);                       <span class="comment">// Check if recipient is frozen</span></span><br><span class="line">    balanceOf[_from] -= _value;                         <span class="comment">// Subtract from the sender</span></span><br><span class="line">    balanceOf[_to] += _value;                           <span class="comment">// Add the same to the recipient</span></span><br><span class="line">    Transfer(_from, _to, _value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在所有你的能够发起代币传输的函数，能够自己做检查然后使用正确的参数来调用transfer。注意这个函数将会移动金币从任何一个账户到另一个账户，不需要任何的权限来执行：这就是为什么这是一个内部函数，智能在合约内部被调用：如果你添加一些函数来调用它，确保应该适当的验证调用者是否有权限。</p>
<h3><span id="集中管理">集中管理</span></h3><p>所有的dapp默认都是完全去中心化的，但这并不意味着他们就不能拥有某些中央管理者。也许你想拥有某些铸币的能力，也许你想禁止某人使用你的货币。你能够任意添加这些功能，但问题是你只能够在一开始就添加它们，因此所有的代币拥有者在拥有这些代币之前都会清楚知道游戏的规则。</p>
<p>要那样做的话，你需要一个货币的中央控制者。这可以是一个简单的账户，但同样可以是一个合约，因此创建更多代币的决议将会取决于这个合约：如果它是一个民主的组织他们可以投票选举，或许这会是限制代币拥有者权力的一种方式。</p>
<p>达到这样的目的我们将会学习一个关于合约的非常有用的性质：<strong>继承</strong>。继承允许一个合约获得它的父合约的属性，这样就不需要重新定义它们。这使得代码清晰整洁并且易于重用。加入这段代码在第一行，在MyToken {之前。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">contract owned &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">owned</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transferOwnership</span>(<span class="params">address newOwner</span>) <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">        owner = newOwner;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里创建了一个非常基础的合约，除了定义了一些通用的函数关于合约能够被“owned”之外不做其它事情。接下来一步就是把这段代码加到你的合约里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">contract MyToken is owned &#123;</span><br><span class="line">    <span class="comment">/* the rest of the contract as usual */</span></span><br></pre></td></tr></table></figure>
<p>这意味着所有在MyToken里的函数能够访问owenr变量以及onlyOwner修改器。这个合约同样获得了一个函数来转移ownership。因为在启动的时候来设置合约的拥有着可能比较有趣，你同样可以添加进构造函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyToken</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 initialSupply,</span></span></span><br><span class="line"><span class="function"><span class="params">    string tokenName,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint8 decimalUnits,</span></span></span><br><span class="line"><span class="function"><span class="params">    string tokenSymbol,</span></span></span><br><span class="line"><span class="function"><span class="params">    address centralMinter</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(centralMinter != <span class="number">0</span> ) owner = centralMinter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="中心化铸币">中心化铸币</span></h3><p>设想你希望改变已经流通的货币数量。比如当你的代币代表了一个区块链资产（比如黄金券或者政府的法币），你希望你的虚拟资产能够反映真实的数量。这同样会是一种情况当货币拥有着希望对代币进行价格上的控制，增发或者从流通的货币中废除一些代币。</p>
<p>首先，我们需要添加一个变量来存储代币总量，同时在构造函数里赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract MyToken &#123;</span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">MyToken</span>(<span class="params">...</span>) </span>&#123;</span><br><span class="line">        totalSupply = initialSupply;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在让我们增加一个新的函数来允许合约拥有着来创建新的代币：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mintToken</span>(<span class="params">address target, uint256 mintedAmount</span>) <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">    balanceOf[target] += mintedAmount;</span><br><span class="line">    totalSupply += mintedAmount;</span><br><span class="line">    Transfer(<span class="number">0</span>, owner, mintedAmount);</span><br><span class="line">    Transfer(owner, target, mintedAmount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这个在函数名后面的onlyOwner修改器。这是指这个函数会在编译的时候将被重写，到继承我们之前定义的onlyOwner修改器。这个函数的代码将会被插入到修改器的函数中，位于下划线的地方，意味着这个特别的函数只能设置为owner的账户所调用。将这段代码其添加到有owner修改器的合约中就能实现铸币功能。</p>
<h3><span id="资产冻结">资产冻结</span></h3><p>根据你自己的用例，你可能有一些管理上的障碍，比如谁能使用谁不能使用你的代币。为了实现这个目的，你可以添加一个参数来允许合约拥有者能够冻结跟解冻资产。</p>
<p>在合约里的任意位置添加这个变量和函数。你可以放在任何位置但我们推荐你把映射跟事件跟其它事件映射放在一起。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mapping (<span class="function"><span class="params">address</span> =&gt;</span> bool) public frozenAccount;</span><br><span class="line">event FrozenFunds(address target, bool frozen);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">freezeAccount</span>(<span class="params">address target, bool freeze</span>) <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">    frozenAccount[target] = freeze;</span><br><span class="line">    FrozenFunds(target, freeze);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了这段代码，所有的账户都是默认未冻结的但合约的拥有者可以设置账户中的任意一个为冻结状态通过调用freezeAccount。不过，冻结功能还不能发挥实际效果因为我们还没有添加相关内容到transfer函数。我们现在来修改一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(!frozenAccount[msg.sender]);</span><br></pre></td></tr></table></figure>
<p>现在任何被冻结的账户任然拥有他们完整的资产，但不能动用他们的资产了。所有的账户默认都是未冻结的直到你冻结他们，但你能轻易的恢复这些行为在白名单里，你需要手动的批准每个账号。重命名frozenAccount函数为approveAccount并且修改最后一行为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(approvedAccount[msg.sender]);</span><br></pre></td></tr></table></figure>
<h3><span id="自动买卖">自动买卖</span></h3><p>到目前为止，你已经基于工具和信任来为你的代币赋值。但如果你想你的代币由以太坊（或者其它代币）来站台，创建一个基金可以自动的按市场价格来进行买卖你的代币。</p>
<p>首先我们设置价格来进行买卖：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uint256 public sellPrice;</span><br><span class="line">uint256 public buyPrice;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPrices</span>(<span class="params">uint256 newSellPrice, uint256 newBuyPrice</span>) <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">    sellPrice = newSellPrice;</span><br><span class="line">    buyPrice = newBuyPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>价格不会被频繁修改是可以被接收的，因为每次新价格的改变会需要你执行一次交易并且花费一点以太坊。如果你想有用一个恒定浮动的价格我们推荐你调查standard data feeds</p>
<p>下一步是创建买卖函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">returns</span> (<span class="params">uint amount</span>)</span>&#123;</span><br><span class="line">    amount = msg.value / buyPrice;                    <span class="comment">// calculates the amount</span></span><br><span class="line">    <span class="built_in">require</span>(balanceOf[<span class="keyword">this</span>] &gt;= amount);               <span class="comment">// checks if it has enough to sell</span></span><br><span class="line">    balanceOf[msg.sender] += amount;                  <span class="comment">// adds the amount to buyer's balance</span></span><br><span class="line">    balanceOf[<span class="keyword">this</span>] -= amount;                        <span class="comment">// subtracts amount from seller's balance</span></span><br><span class="line">    Transfer(<span class="keyword">this</span>, msg.sender, amount);               <span class="comment">// execute an event reflecting the change</span></span><br><span class="line">    <span class="keyword">return</span> amount;                                    <span class="comment">// ends function and returns</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sell</span>(<span class="params">uint amount</span>) <span class="title">returns</span> (<span class="params">uint revenue</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(balanceOf[msg.sender] &gt;= amount);         <span class="comment">// checks if the sender has enough to sell</span></span><br><span class="line">    balanceOf[<span class="keyword">this</span>] += amount;                        <span class="comment">// adds the amount to owner's balance</span></span><br><span class="line">    balanceOf[msg.sender] -= amount;                  <span class="comment">// subtracts the amount from seller's balance</span></span><br><span class="line">    revenue = amount * sellPrice;</span><br><span class="line">    msg.sender.transfer(revenue);                     <span class="comment">// sends ether to the seller: it's important to do this last to prevent recursion attacks</span></span><br><span class="line">    Transfer(msg.sender, <span class="keyword">this</span>, amount);               <span class="comment">// executes an event reflecting on the change</span></span><br><span class="line">    <span class="keyword">return</span> revenue;                                   <span class="comment">// ends function and returns</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这不会创建新的代币只是更改合约拥有的余额。合约能够同时拥有它自己的代币数量，以太数以及合约的拥有者，当它能够设置价格或者在某些情况可以创建新的代币（如果可以），它并不会本来的代币跟以太。此合同能转移资金的唯一方式就是买卖它们。</p>
<p>注意买卖的价格单位不是以太，是wei，这个是整个系统的最小货币单位（相当于欧元跟美元里的分，或者比特币里面的聪）。一个以太等于1000000000000000000 wei。所以当你设置你代币的价格的时候，需要在末尾添加18个零。</p>
<p>当创建合约时，要发送足够的以太，这样它能在市场上买回所有的代币，要不然你的合同就会破产，你的用户将不能出售它们的代币。</p>
<p>当然前面的例子描述的是一个单一的中心化的买家和卖家的合约。更有趣的合约会允许任何人出价，或者从外部直接报价的市场。</p>
<h3><span id="自动重填">自动重填</span></h3><p>每一次，你在以太坊进行一次交易，都需要支付一笔费用给打包区块的矿工它们会计算智能合约的结果。这可能会在未来改变，但当前费用只能被以以太支付，因此所有你的代币的拥有者都需要以太。账户的代币余额如果小于这笔费用会被暂时卡住直到用户能够支付交易费。但在一些情况里，你可能不希望你的用户去考虑以太坊，区块链以及怎样获取以太，所以一种可能是让你的代币可以自动重新填充用户的余额当它发现用户的余额低的比较危险。</p>
<p>为了做到这个，首先你需要创建一个变量来存储阈值以及一个函数来修改这个变量。如果你不知道这个值是多少，将它设置为5 finney (0.005 ether).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uint minBalanceForAccounts;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setMinBalance</span>(<span class="params">uint minimumBalanceInFinney</span>) <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">     minBalanceForAccounts = minimumBalanceInFinney * <span class="number">1</span> finney;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着，添加这行代码到交易函数，这样能确保发送者得到退款：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Send coins */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span>(msg.sender.balance &lt; minBalanceForAccounts)</span><br><span class="line">        sell((minBalanceForAccounts - msg.sender.balance) / sellPrice);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你也可以更改它让这笔费用由发送方支付给接收者：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Send coins */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span>(_to.balance&lt;minBalanceForAccounts)</span><br><span class="line">        _to.send(sell((minBalanceForAccounts - _to.balance) / sellPrice));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="工作量证明">工作量证明</span></h3><p>这里有一些方法来将你的代币供应绑定到一个数学的公式上。其中一个最简单的方式叫做与以太结合的“混合挖矿”，意思是任何人谁找到了以太坊的一个新区块将同样获得你的代币的奖励，开放给任何人调用奖励函数在新区块上。你能够使用特别的关键字coinbase用来表示发现新区快的矿工。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function giveBlockReward() &#123;</span><br><span class="line">    balanceOf[block.coinbase] += 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样也可以添加一个数学公式，这样任何人谁能解开数学公式就能获得奖励。在接下来的例子中你必须计算立方根：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uint currentChallenge = <span class="number">1</span>; <span class="comment">// Can you figure out the cubic root of this number?</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rewardMathGeniuses</span>(<span class="params">uint answerToCurrentReward, uint nextChallenge</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(answerToCurrentReward**<span class="number">3</span> == currentChallenge); <span class="comment">// If answer is wrong do not continue</span></span><br><span class="line">    balanceOf[msg.sender] += <span class="number">1</span>;         <span class="comment">// Reward the player</span></span><br><span class="line">    currentChallenge = nextChallenge;   <span class="comment">// Set the next challenge</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，计算立方根对于某人用大脑来说的话比较难，但对于计算器来说非常简单，所以这个游戏会被计算机轻松破解。同样最后的胜利者可以选择下一个挑战，他们能选择他们熟悉的一些东西所以对所有玩家来说可能并不是很公平。这有一些任务可能对于人类来说比较简单但对计算机比较难但通常会比较难以编码。取而代之，一个公平的系统应该是对于计算机来说难于计算的，但容易验证结果。一个不错的选择就是创建一个hash竞赛，然后参与者必须从多个数字中算出hash值直到他们能找到一个比给定难度低的值。</p>
<p>这一过程首先被Adam Back在1997年设计Hashcash的时候提出同样在2008年中本聪的比特币将其作为工作量证明的算实现。以太坊项目启动的时候使用了这个系统作为它的安全模型，但未来将从工作量证明安全模型转移到混合权益证明和一个经常叫做Casper的系统。</p>
<p>但如果你喜欢使用hash算法作为随机发行代币的一种方式，你能够继续创建你自己的基于工作量证明发行的以太坊上的货币：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">bytes32 public currentChallenge;                         <span class="comment">// The coin starts with a challenge</span></span><br><span class="line">uint public timeOfLastProof;                             <span class="comment">// Variable to keep track of when rewards were given</span></span><br><span class="line">uint public difficulty = <span class="number">10</span>**<span class="number">32</span>;                         <span class="comment">// Difficulty starts reasonably low</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">proofOfWork</span>(<span class="params">uint nonce</span>)</span>&#123;</span><br><span class="line">    bytes8 n = bytes8(sha3(nonce, currentChallenge));    <span class="comment">// Generate a random hash based on input</span></span><br><span class="line">    <span class="built_in">require</span>(n &gt;= bytes8(difficulty));                   <span class="comment">// Check if it's under the difficulty</span></span><br><span class="line"></span><br><span class="line">    uint timeSinceLastProof = (now - timeOfLastProof);  <span class="comment">// Calculate time since last reward was given</span></span><br><span class="line">    <span class="built_in">require</span>(timeSinceLastProof &gt;=  <span class="number">5</span> seconds);         <span class="comment">// Rewards cannot be given too quickly</span></span><br><span class="line">    balanceOf[msg.sender] += timeSinceLastProof / <span class="number">60</span> seconds;  <span class="comment">// The reward to the winner grows by the minute</span></span><br><span class="line"></span><br><span class="line">    difficulty = difficulty * <span class="number">10</span> minutes / timeSinceLastProof + <span class="number">1</span>;  <span class="comment">// Adjusts the difficulty</span></span><br><span class="line"></span><br><span class="line">    timeOfLastProof = now;                              <span class="comment">// Reset the counter</span></span><br><span class="line">    currentChallenge = sha3(nonce, currentChallenge, block.blockhash(block.number - <span class="number">1</span>));  <span class="comment">// Save a hash that will be used as the next proof</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样改变构造函数，增加这行代码，所以难度调整将不会很疯狂：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeOfLastProof = now;</span><br></pre></td></tr></table></figure>
<h2><span id="改进的代币">改进的代币</span></h2><h3><span id="完整代码">完整代码</span></h3><p>如果你添加了所有这些高级的属性，那么代码应该看上去像这样：</p>
<p><img src="https://www.ethereum.org/images/tutorial/advanced-token-deploy.png" alt="image"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.16</span>;</span><br><span class="line"></span><br><span class="line">contract owned &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">owned</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transferOwnership</span>(<span class="params">address newOwner</span>) <span class="title">onlyOwner</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">        owner = newOwner;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface tokenRecipient &#123; <span class="function"><span class="keyword">function</span> <span class="title">receiveApproval</span>(<span class="params">address _from, uint256 _value, address _token, bytes _extraData</span>) <span class="title">public</span>; &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">contract</span> <span class="title">TokenERC20</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Public variables of the token</span></span><br><span class="line">    string public name;</span><br><span class="line">    string public symbol;</span><br><span class="line">    uint8 public decimals = <span class="number">18</span>;</span><br><span class="line">    <span class="comment">// 18 decimals is the strongly suggested default, avoid changing it</span></span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This creates an array with all balances</span></span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balanceOf;</span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This generates a public event on the blockchain that will notify clients</span></span><br><span class="line">    event Transfer(address indexed <span class="keyword">from</span>, address indexed to, uint256 value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This notifies clients about the amount burnt</span></span><br><span class="line">    event Burn(address indexed <span class="keyword">from</span>, uint256 value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constrctor function</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Initializes contract with initial supply tokens to the creator of the contract</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">TokenERC20</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        uint256 initialSupply,</span></span></span><br><span class="line"><span class="function"><span class="params">        string tokenName,</span></span></span><br><span class="line"><span class="function"><span class="params">        string tokenSymbol</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        totalSupply = initialSupply * <span class="number">10</span> ** uint256(decimals);  <span class="comment">// Update total supply with the decimal amount</span></span><br><span class="line">        balanceOf[msg.sender] = totalSupply;                <span class="comment">// Give the creator all initial tokens</span></span><br><span class="line">        name = tokenName;                                   <span class="comment">// Set the name for display purposes</span></span><br><span class="line">        symbol = tokenSymbol;                               <span class="comment">// Set the symbol for display purposes</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Internal transfer, only can be called by this contract</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint _value</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Prevent transfer to 0x0 address. Use burn() instead</span></span><br><span class="line">        <span class="built_in">require</span>(_to != <span class="number">0x0</span>);</span><br><span class="line">        <span class="comment">// Check if the sender has enough</span></span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_from] &gt;= _value);</span><br><span class="line">        <span class="comment">// Check for overflows</span></span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_to] + _value &gt; balanceOf[_to]);</span><br><span class="line">        <span class="comment">// Save this for an assertion in the future</span></span><br><span class="line">        uint previousBalances = balanceOf[_from] + balanceOf[_to];</span><br><span class="line">        <span class="comment">// Subtract from the sender</span></span><br><span class="line">        balanceOf[_from] -= _value;</span><br><span class="line">        <span class="comment">// Add the same to the recipient</span></span><br><span class="line">        balanceOf[_to] += _value;</span><br><span class="line">        Transfer(_from, _to, _value);</span><br><span class="line">        <span class="comment">// Asserts are used to use static analysis to find bugs in your code. They should never fail</span></span><br><span class="line">        assert(balanceOf[_from] + balanceOf[_to] == previousBalances);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transfer tokens</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Send `_value` tokens to `_to` from your account</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _to The address of the recipient</span></span><br><span class="line"><span class="comment">     * @param _value the amount to send</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _value</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        _transfer(msg.sender, _to, _value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transfer tokens from other address</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Send `_value` tokens to `_to` in behalf of `_from`</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _from The address of the sender</span></span><br><span class="line"><span class="comment">     * @param _to The address of the recipient</span></span><br><span class="line"><span class="comment">     * @param _value the amount to send</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transferFrom</span>(<span class="params">address _from, address _to, uint256 _value</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(_value &lt;= allowance[_from][msg.sender]);     <span class="comment">// Check allowance</span></span><br><span class="line">        allowance[_from][msg.sender] -= _value;</span><br><span class="line">        _transfer(_from, _to, _value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set allowance for other address</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Allows `_spender` to spend no more than `_value` tokens in your behalf</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _spender The address authorized to spend</span></span><br><span class="line"><span class="comment">     * @param _value the max amount they can spend</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _spender, uint256 _value</span>) <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        allowance[msg.sender][_spender] = _value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set allowance for other address and notify</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Allows `_spender` to spend no more than `_value` tokens in your behalf, and then ping the contract about it</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _spender The address authorized to spend</span></span><br><span class="line"><span class="comment">     * @param _value the max amount they can spend</span></span><br><span class="line"><span class="comment">     * @param _extraData some extra information to send to the approved contract</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">approveAndCall</span>(<span class="params">address _spender, uint256 _value, bytes _extraData</span>)</span></span><br><span class="line"><span class="function">        <span class="title">public</span></span></span><br><span class="line"><span class="function">        <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        tokenRecipient spender = tokenRecipient(_spender);</span><br><span class="line">        <span class="keyword">if</span> (approve(_spender, _value)) &#123;</span><br><span class="line">            spender.receiveApproval(msg.sender, _value, <span class="keyword">this</span>, _extraData);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Destroy tokens</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Remove `_value` tokens from the system irreversibly</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _value the amount of money to burn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">burn</span>(<span class="params">uint256 _value</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[msg.sender] &gt;= _value);   <span class="comment">// Check if the sender has enough</span></span><br><span class="line">        balanceOf[msg.sender] -= _value;            <span class="comment">// Subtract from the sender</span></span><br><span class="line">        totalSupply -= _value;                      <span class="comment">// Updates totalSupply</span></span><br><span class="line">        Burn(msg.sender, _value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Destroy tokens from other account</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param _from the address of the sender</span></span><br><span class="line"><span class="comment">     * @param _value the amount of money to burn</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">burnFrom</span>(<span class="params">address _from, uint256 _value</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool success</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balanceOf[_from] &gt;= _value);                <span class="comment">// Check if the targeted balance is enough</span></span><br><span class="line">        <span class="built_in">require</span>(_value &lt;= allowance[_from][msg.sender]);    <span class="comment">// Check allowance</span></span><br><span class="line">        balanceOf[_from] -= _value;                         <span class="comment">// Subtract from the targeted balance</span></span><br><span class="line">        allowance[_from][msg.sender] -= _value;             <span class="comment">// Subtract from the sender's allowance</span></span><br><span class="line">        totalSupply -= _value;                              <span class="comment">// Update totalSupply</span></span><br><span class="line">        Burn(_from, _value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*       ADVANCED TOKEN STARTS HERE       */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"></span><br><span class="line">contract MyAdvancedToken is owned, TokenERC20 &#123;</span><br><span class="line"></span><br><span class="line">    uint256 public sellPrice;</span><br><span class="line">    uint256 public buyPrice;</span><br><span class="line"></span><br><span class="line">    mapping (<span class="function"><span class="params">address</span> =&gt;</span> bool) public frozenAccount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* This generates a public event on the blockchain that will notify clients */</span></span><br><span class="line">    event FrozenFunds(address target, bool frozen);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Initializes contract with initial supply tokens to the creator of the contract */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">MyAdvancedToken</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        uint256 initialSupply,</span></span></span><br><span class="line"><span class="function"><span class="params">        string tokenName,</span></span></span><br><span class="line"><span class="function"><span class="params">        string tokenSymbol</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) <span class="title">TokenERC20</span>(<span class="params">initialSupply, tokenName, tokenSymbol</span>) <span class="title">public</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Internal transfer, only can be called by this contract */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint _value</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">        <span class="built_in">require</span> (_to != <span class="number">0x0</span>);                               <span class="comment">// Prevent transfer to 0x0 address. Use burn() instead</span></span><br><span class="line">        <span class="built_in">require</span> (balanceOf[_from] &gt;= _value);               <span class="comment">// Check if the sender has enough</span></span><br><span class="line">        <span class="built_in">require</span> (balanceOf[_to] + _value &gt; balanceOf[_to]); <span class="comment">// Check for overflows</span></span><br><span class="line">        <span class="built_in">require</span>(!frozenAccount[_from]);                     <span class="comment">// Check if sender is frozen</span></span><br><span class="line">        <span class="built_in">require</span>(!frozenAccount[_to]);                       <span class="comment">// Check if recipient is frozen</span></span><br><span class="line">        balanceOf[_from] -= _value;                         <span class="comment">// Subtract from the sender</span></span><br><span class="line">        balanceOf[_to] += _value;                           <span class="comment">// Add the same to the recipient</span></span><br><span class="line">        Transfer(_from, _to, _value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @notice Create `mintedAmount` tokens and send it to `target`</span></span><br><span class="line">    <span class="comment">/// @param target Address to receive the tokens</span></span><br><span class="line">    <span class="comment">/// @param mintedAmount the amount of tokens it will receive</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">mintToken</span>(<span class="params">address target, uint256 mintedAmount</span>) <span class="title">onlyOwner</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">        balanceOf[target] += mintedAmount;</span><br><span class="line">        totalSupply += mintedAmount;</span><br><span class="line">        Transfer(<span class="number">0</span>, <span class="keyword">this</span>, mintedAmount);</span><br><span class="line">        Transfer(<span class="keyword">this</span>, target, mintedAmount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @notice `freeze? Prevent | Allow` `target` from sending &amp; receiving tokens</span></span><br><span class="line">    <span class="comment">/// @param target Address to be frozen</span></span><br><span class="line">    <span class="comment">/// @param freeze either to freeze it or not</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">freezeAccount</span>(<span class="params">address target, bool freeze</span>) <span class="title">onlyOwner</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">        frozenAccount[target] = freeze;</span><br><span class="line">        FrozenFunds(target, freeze);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @notice Allow users to buy tokens for `newBuyPrice` eth and sell tokens for `newSellPrice` eth</span></span><br><span class="line">    <span class="comment">/// @param newSellPrice Price the users can sell to the contract</span></span><br><span class="line">    <span class="comment">/// @param newBuyPrice Price users can buy from the contract</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setPrices</span>(<span class="params">uint256 newSellPrice, uint256 newBuyPrice</span>) <span class="title">onlyOwner</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">        sellPrice = newSellPrice;</span><br><span class="line">        buyPrice = newBuyPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @notice Buy tokens from contract by sending ether</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">        uint amount = msg.value / buyPrice;               <span class="comment">// calculates the amount</span></span><br><span class="line">        _transfer(<span class="keyword">this</span>, msg.sender, amount);              <span class="comment">// makes the transfers</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @notice Sell `amount` tokens to contract</span></span><br><span class="line">    <span class="comment">/// @param amount amount of tokens to be sold</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sell</span>(<span class="params">uint256 amount</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(<span class="keyword">this</span>.balance &gt;= amount * sellPrice);      <span class="comment">// checks if the contract has enough ether to buy</span></span><br><span class="line">        _transfer(msg.sender, <span class="keyword">this</span>, amount);              <span class="comment">// makes the transfers</span></span><br><span class="line">        msg.sender.transfer(amount * sellPrice);          <span class="comment">// sends ether to the seller. It's important to do this last to avoid recursion attacks</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="发布">发布</span></h3><p>滚动到最下面你会看到预估的部署成本价格。你也可以自己改变滑块来设置一个更少的费用，但如果价格比平均市场费率低太多的话你的交易会花费很长的时间打包。点击部署然后输入你的密码。不一会你会到控制面板最下面的交易里你会看到你的合约正在创建。等待交易被打包后，你的合于会创建成功。</p>
<p><img src="https://www.ethereum.org/images/tutorial/created-token.png" alt="image"></p>
<p>点击代币合约的管理页面链接，你将会来到世界上最简单的中央银行控制面板，你在这里对你的货币做任何你想做的事情。</p>
<p>在左侧的Readfrom contract下面你能从合约里读取信息，免费的。如果你的代币拥有一个拥有者，它会显示其地址。拷贝地址粘贴到balance of将会显示任意账户的余额（余额同样会自动显示在任何拥有这些代币的账户页面里）。</p>
<p>在右侧，在Write to Contract下，你会看到所有的函数你用来修改你的区块链，这些操作会消耗gas。如果你创建了一个允许挖矿的合约，你将拥有一个函数叫做“Mint Token”。选择它。</p>
<p><img src="https://www.ethereum.org/images/tutorial/manage-central-dollar.png" alt="image"></p>
<p>选择需要创建新的货币的地址，然后是数量（如果你的小数位设置为2，在金额的后面添加两个0，来创建正确的数量）。在<strong>Execute from</strong>选择设置为owener的账户，将以太的金额设置为0然后点击执行。</p>
<p>等待一些确认后，接收者的余额会更新为新的金额。但接收者的钱包可能没法自动显示：设置查看代币。</p>
<p><img src="https://www.ethereum.org/images/tutorial/add-token.png" alt="image"></p>
<h2><span id="使用你的代币">使用你的代币</span></h2><p>一旦你发布了你的代币，他们会被添加到你的被观察代币的列表里，代币余额会显示在你的账户里。如果要发送代币，去发送界面选择一个有代币的账户，选择一个并且输入你想要发送的代币的数量。</p>
<p>如果你希望添加其它人的代币，转到合约页面，点击观察代币。比如，添加独角兽（🦄）代币到你的观察列表里，添加地址0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7，剩下的信息会自动载入进来。点击OK你的代币会被添加进来。</p>
<p><img src="https://www.ethereum.org/images/tutorial/unicorn-token.png" alt="image"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="李工" />
          <p class="site-author-name" itemprop="name">李工</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="liiijz@163.com" target="_blank" title="email">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      email
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank" title="twitter">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      twitter
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      github
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank" title="googleplus">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      googleplus
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="/atom.xml" target="_blank" title="rss">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      rss
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李工</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
